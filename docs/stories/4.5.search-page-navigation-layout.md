# Story 4.5: Search Page Navigation & Layout

## Status
Approved

## Story
**As a** user on the search page,
**I want** clear navigation and focused layout,
**so that** I can complete my search efficiently.

## Acceptance Criteria
1. **BC1**: Navigation enhancements don't conflict with existing routing
2. **BC2**: Clear "Back to Home" navigation preserves browser history
3. **BC3**: Layout optimization doesn't break existing component rendering
4. **BC4**: Progress indicators integrate seamlessly with existing job status updates
5. **BC5**: All accessibility features preserved and enhanced

## Tasks / Subtasks

- [ ] **Task 1: Create SearchPageLayout Component** (AC: BC1, BC3)
  - [ ] Create new file `src/components/SearchPageLayout.tsx`
  - [ ] Implement layout wrapper with header, main content, and footer sections
  - [ ] Add support for different workflow steps (setup, searching, results)
  - [ ] Include optional breadcrumb and back navigation support
  - [ ] Test layout wrapper doesn't break existing component rendering

- [ ] **Task 2: Implement Advanced Navigation System** (AC: BC1, BC2, BC5)
  - [ ] Create `SearchPageHeader` component with multi-level navigation
  - [ ] Implement breadcrumb navigation (Home > Search > Results)
  - [ ] Add back navigation that preserves browser history
  - [ ] Include action shortcuts for common operations
  - [ ] Ensure keyboard navigation accessibility

- [ ] **Task 3: Create Workflow Progress Indicators** (AC: BC4)
  - [ ] Create new file `src/components/SearchProgressIndicator.tsx`
  - [ ] Define workflow steps (Setup, Finding Leads, Enriching Data, View Results)
  - [ ] Implement visual progress indicator with icons and connections
  - [ ] Integrate with existing job status from useLeadGeneration hook
  - [ ] Add time estimates and contextual status messages

- [ ] **Task 4: Build Context-Aware Action Bar** (AC: BC3)
  - [ ] Create new file `src/components/SearchActionBar.tsx`
  - [ ] Implement different action sets for each workflow phase:
    - Setup: Load Demo Template, Load Previous Search, Clear Form
    - Processing: Pause Search, Cancel Search
    - Results: Export CSV, Send to CRM, Refine Search, New Search
  - [ ] Test action bar doesn't interfere with existing functionality

- [ ] **Task 5: Implement Adaptive Layout System** (AC: BC3, BC5)
  - [ ] Create new file `src/components/AdaptiveSearchLayout.tsx`
  - [ ] Implement form-focused layout for setup phase (single column)
  - [ ] Implement progress-focused layout for processing phase (centered)
  - [ ] Implement results-focused layout for results phase (full width)
  - [ ] Ensure responsive breakpoints work on all devices

- [ ] **Task 6: Add Keyboard Shortcuts System** (AC: BC5)
  - [ ] Define keyboard shortcuts for common actions
  - [ ] Implement shortcut handlers with proper event management
  - [ ] Add contextual shortcut hints in UI
  - [ ] Ensure shortcuts don't conflict with existing browser/form shortcuts
  - [ ] Test full keyboard navigation support

- [ ] **Task 7: Implement Search History & Templates** (AC: BC4)
  - [ ] Create new file `src/components/SearchHistory.tsx`
  - [ ] Add recent searches quick access functionality
  - [ ] Implement search template save/load functionality
  - [ ] Add quick actions for clone, edit, delete operations
  - [ ] Integrate with state persistence from Story 4.3

- [ ] **Task 8: Add Help & Guidance System** (AC: BC5)
  - [ ] Implement contextual tips for each workflow step
  - [ ] Add progress hints explaining current processing stage
  - [ ] Create error recovery guidance for failure scenarios
  - [ ] Ensure help system is accessible and non-intrusive
  - [ ] Test guidance system enhances rather than clutters UX

- [ ] **Task 9: Integrate Layout Components** (AC: All)
  - [ ] Update `src/pages/Search.tsx` to use new layout components
  - [ ] Implement layout switching based on current workflow step
  - [ ] Test complete navigation flow from landing page through results
  - [ ] Ensure all existing functionality preserved with enhanced layout

- [ ] **Task 10: Quality Assurance Testing** (AC: All)
  - [ ] Test advanced navigation across all user scenarios
  - [ ] Verify progress indicators accurately reflect job status
  - [ ] Test adaptive layouts on multiple screen sizes
  - [ ] Verify accessibility features (keyboard nav, screen readers)
  - [ ] Run comprehensive integration testing

## Dev Notes

### Previous Story Context
**Story 4.1**: Landing page CTAs navigate to `/search`
**Story 4.2**: Basic search page created with simple back navigation
**Story 4.3**: State persistence enables search restoration
**Story 4.4**: Enhanced CTAs drive more traffic to search page
**Story 4.5**: This story creates sophisticated navigation and workflow-optimized layouts

### Search Workflow Architecture
[Source: Architect's workflow design & CLAUDE.md#Critical System Components]
**Job Status Transitions**: `pending` → `processing` → `searching` → `enriching` → `validating` → `finalizing` → `completed`

**Workflow Steps Mapping**:
```typescript
const SEARCH_STEPS = [
  { id: 'setup', label: 'Search Setup', icon: Target, statuses: ['idle'] },
  { id: 'processing', label: 'Finding Leads', icon: Search, statuses: ['pending', 'processing', 'searching'] },  
  { id: 'enriching', label: 'Enriching Data', icon: Sparkles, statuses: ['enriching', 'validating'] },
  { id: 'results', label: 'View Results', icon: BarChart, statuses: ['finalizing', 'completed'] }
];
```

### Current Search Page Structure
[Source: Story 4.2 implementation]
**Basic Structure**: Simple header with back navigation, main content area
**Enhancement Target**: Sophisticated workflow-aware navigation and adaptive layouts
**Existing Components**: LeadGenForm, LeadGenResults integrated successfully
**Integration Points**: useLeadGeneration hook provides job status for progress tracking

### Layout Component Architecture
[Source: Component design pattern]
```typescript
interface SearchPageLayoutProps {
  children: React.ReactNode;
  currentStep?: 'setup' | 'searching' | 'results';
  showBackNav?: boolean;
  breadcrumbs?: Array<{label: string, href?: string}>;
}
```
**Design Pattern**: Layout wrapper that adapts to workflow state
**Flexibility**: Support for different content types and navigation needs

### Navigation System Requirements
[Source: Advanced navigation strategy]
- **Multi-Level**: Home > Search > Results with proper breadcrumbs
- **Browser Integration**: Proper history management and back button support
- **Shortcuts**: Quick access to common actions at each workflow step
- **Context Awareness**: Different navigation options based on current step

### Progress Indicator Integration
[Source: Real-time job status system]
**Data Source**: useLeadGeneration hook provides `currentJob.status`
**Real-time Updates**: Progress indicators update as job status changes
**Visual Design**: Neumorphic styling consistent with application theme
**User Feedback**: Clear indication of current step and estimated completion

### Adaptive Layout Strategy
[Source: UX optimization for different workflow phases]

**Setup Phase (Form-Focused)**:
```typescript
<div className="max-w-4xl mx-auto">
  <SearchForm />
</div>
```

**Processing Phase (Progress-Focused)**:
```typescript
<div className="max-w-2xl mx-auto text-center">
  <SearchProgress />
  <SearchStatus />
</div>
```

**Results Phase (Data-Focused)**:
```typescript
<div className="max-w-[1600px] mx-auto">
  <ResultsSummary />
  <ResultsTable />
  <ResultsCharts />
</div>
```

### Action Bar Context Switching
[Source: Contextual actions design]
**Setup Phase Actions**: Template loading, form management, clear operations
**Processing Phase Actions**: Job control (pause, cancel, status)
**Results Phase Actions**: Data export, CRM integration, new search initiation
**Implementation**: Conditional rendering based on workflow step

### Keyboard Shortcuts Design
[Source: Accessibility and power user features]
```typescript
const SHORTCUTS = {
  'Ctrl+Enter': 'Start Search',
  'Ctrl+N': 'New Search', 
  'Ctrl+S': 'Save Template',
  'Escape': 'Cancel/Back',
  'Ctrl+E': 'Export Results'
};
```
**Accessibility**: Full keyboard navigation support
**User Experience**: Optional shortcuts for power users
**Conflict Avoidance**: Don't override browser or form shortcuts

### Search History Integration
[Source: State persistence from Story 4.3]
**Data Source**: Session storage utilities from Story 4.3
**Functionality**: Quick access to recent searches, template management
**User Experience**: One-click search restoration and modification
**Privacy**: Session-scoped data, respects user privacy

### Responsive Design Requirements
[Source: Mobile-first approach]
- **Mobile**: Single column, stacked navigation, simplified actions
- **Tablet**: Balanced layout, accessible touch targets
- **Desktop**: Full width utilization, multiple columns, advanced features
- **Accessibility**: Works with screen readers, keyboard navigation

### Integration with Existing Components
[Source: Brownfield integration requirements]
**Preserve Functionality**: All existing LeadGenForm and LeadGenResults functionality
**Enhance Experience**: Layer navigation and layout improvements over existing code
**State Management**: Work with existing useLeadGeneration hook without modification
**Styling**: Maintain neumorphic design consistency

### Error Handling and Edge Cases
[Source: Robust navigation system requirements]
- **Network Issues**: Graceful handling of connectivity problems
- **Invalid States**: Handle unexpected job statuses or navigation states
- **Browser Issues**: Fallback navigation for history API problems  
- **User Errors**: Clear recovery paths for user mistakes

### Performance Considerations
[Source: Application performance requirements]
- **Lazy Loading**: Load navigation components as needed
- **Efficient Updates**: Minimize re-renders during real-time updates
- **Memory Management**: Clean up event listeners and subscriptions
- **Bundle Impact**: Keep new components lightweight

### Testing
**Testing Standards**:
[Source: CLAUDE.md#Development Workflow]
- **Framework**: Vitest with React Testing Library for component testing
- **Integration**: Test complete navigation flows end-to-end
- **Accessibility**: axe-core for automated accessibility testing
- **Responsive**: Test layouts across viewport sizes

**Critical Test Scenarios**:
- **Navigation Flow**: Landing page → Search → Results with proper state
- **Progress Indicators**: Accurately reflect real-time job status updates
- **Adaptive Layouts**: Proper layout switching based on workflow step
- **Keyboard Navigation**: Full accessibility via keyboard only
- **Action Bars**: Context-appropriate actions available at each step
- **Search History**: Template saving, loading, and management
- **Error Recovery**: Graceful handling of navigation failures
- **Responsive Behavior**: Layouts work across all screen sizes
- **Browser Compatibility**: Navigation works across supported browsers

**Test File Locations**:
- `src/components/__tests__/SearchPageLayout.test.tsx` - Layout wrapper
- `src/components/__tests__/SearchProgressIndicator.test.tsx` - Progress system
- `src/components/__tests__/SearchActionBar.test.tsx` - Context actions
- `src/components/__tests__/AdaptiveSearchLayout.test.tsx` - Adaptive layouts
- `src/components/__tests__/SearchHistory.test.tsx` - History management
- Integration tests for complete navigation workflow

### Accessibility Implementation
[Source: WCAG 2.1 compliance requirements]
- **Semantic HTML**: Proper heading hierarchy and navigation landmarks
- **ARIA Labels**: Descriptive labels for complex navigation elements
- **Focus Management**: Logical tab order and visible focus indicators
- **Screen Readers**: Navigation announcements and state changes
- **Keyboard Only**: Full functionality accessible without mouse

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-02 | 1.0 | Initial story creation | Scrum Master Bob |
| 2025-01-02 | 1.1 | Status updated to Approved | Scrum Master Bob |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent review will be populated here after implementation*