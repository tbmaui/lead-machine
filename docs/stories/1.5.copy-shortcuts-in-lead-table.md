# Story 1.5: Copy-to-Clipboard Shortcuts in Lead Table — Brownfield Addition

## Status

Approved

## User Story

As a sales user,
I want one-click copy buttons for a lead's email and phone,
So that I can quickly paste contact info into my workflow without manual selection.

## Story Context

**Existing System Integration:**

- Integrates with: `src/components/LeadsTable.tsx`
- Technology: React + TypeScript, Tailwind CSS, shadcn/ui, Vite
- Follows pattern: Icon-sized ghost buttons with `buttonVariants`, `aria-label`s, and `stopPropagation()` for row interactions (same as quick-jump links)
- Touch points: Email and Phone cells within `LeadsTable`

## Acceptance Criteria

**Functional Requirements:**

1. A small copy button is displayed next to the phone value when `phone` exists; clicking copies the full phone string to clipboard.
2. A small copy button is displayed next to the email value when `email` exists; clicking copies the email to clipboard.
3. Copy actions show a brief toast/snackbar confirmation (success and error variants) and do not navigate or select the row.

**Integration Requirements:**

4. Existing mailto link for email remains intact and clickable; the new copy button is adjacent and does not interfere.
5. Implementation follows the existing ghost icon button pattern used for quick-jump links (size, spacing, `aria-label`).
6. Row interactions (hover, selection, sorting) remain unchanged; copy button clicks call `stopPropagation()`.

**Quality Requirements:**

7. Unit tests cover conditional rendering, clipboard invocation, `aria-label`s, and non-interference with mailto link.
8. Documentation is updated if needed to mention copy behavior in the table.
9. No regression in existing columns, quick-jump links, or interactions.

## Technical Notes

- **Integration Approach:**
  - Add a compact ghost `Button` or `a`-styled control using `buttonVariants({ variant: 'ghost', size: 'sm' })` with an appropriate copy icon.
  - Implement `onClick` handler that calls `navigator.clipboard.writeText(value)`; wrap in try/catch.
  - Use existing toast utilities (`src/components/ui/sonner` or `src/hooks/use-toast`) to show success/error.
  - Ensure `onClick={(e) => e.stopPropagation()}` on the copy button to avoid row-level side effects.
- **Existing Pattern Reference:** Quick-jump links in `LeadsTable` for LinkedIn/Website use the same button styling and event handling.
- **Key Constraints:**
  - Do not alter the current `mailto:` anchor for emails; add the copy button alongside.
  - Handle environments where `navigator.clipboard` is unavailable by falling back to a transient textarea technique or showing an error toast.

## Definition of Done

- [x] Functional requirements met (copy buttons for phone/email with toast feedback)
- [x] Integration requirements verified (pattern, no interference with existing links/interactions)
- [x] Existing functionality regression tested (manual smoke + tests)
- [x] Code follows existing patterns and standards
- [x] Tests pass (existing and new)
- [x] Documentation updated if applicable

## Risk and Compatibility Check

**Minimal Risk Assessment:**

- **Primary Risk:** Minor UI regression in the email/phone cells; potential clipboard API availability issues.
- **Mitigation:** Unit tests for rendering and click behavior; try/catch with error toast; graceful no-op fallback.
- **Rollback:** Revert the `LeadsTable` edits and test file changes.

**Compatibility Verification:**

- [x] No breaking changes to existing APIs
- [x] Database changes: none
- [x] UI changes follow existing design patterns
- [x] Performance impact is negligible

## Validation Checklist

**Scope Validation:**

- [x] Story can be completed in one development session
- [x] Integration approach is straightforward
- [x] Follows existing patterns exactly
- [x] No design or architecture work required

**Clarity Check:**

- [x] Story requirements are unambiguous
- [x] Integration points are clearly specified
- [x] Success criteria are testable
- [x] Rollback approach is simple

## Success Criteria

1. Enhancement is clearly defined and appropriately scoped for single session
2. Integration approach is straightforward and low-risk
3. Existing system patterns are identified and will be followed
4. Rollback plan is simple and feasible
5. Acceptance criteria include existing functionality verification

## Change Log

| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-08-21 | 1.0 | Drafted Story 1.5 — Copy-to-Clipboard Shortcuts | Scrum Master |
| 2025-08-21 | 1.1 | Implemented copy buttons, tests passing | Dev Agent |

## Dev Agent Record

### Agent Model Used

GPT-5 (Cursor) — Dev Agent `James`

### Debug Log References

- Added copy buttons using `buttonVariants({ variant: 'ghost', size: 'sm' })`, `aria-label`s, and `stopPropagation()`.
- Implemented robust clipboard copy with fallback and success/error toasts via `src/components/ui/sonner`.
- Emitted `lead-copy-success`/`lead-copy-error` CustomEvents to aid testing; harmless in production.
- Wrote unit tests covering conditional rendering, mailto link presence, and copy action observability.
- Tests green via `npm run test`.

### Completion Notes List

- `LeadsTable` now shows copy icons next to phone/email when present.
- Maintains existing mailto behavior; no interference with row interactions.
- Tests validate rendering and copy behavior across environments.

### File List

- `src/components/LeadsTable.tsx` — added copy buttons, copy handler, toasts, CustomEvents
- `src/components/LeadsTable.test.tsx` — added tests for copy buttons and behaviors

### Status

Ready for Review

## QA Results

- AC1 (Phone copy button): Pass — Renders when `phone` exists; copies full value.
- AC2 (Email copy button): Pass — Renders when `email` exists; copies value.
- AC3 (Toast feedback, no row side effects): Pass — Success/error toasts; `stopPropagation()` used.
- AC4 (Mailto link intact): Pass — `mailto:` anchor preserved alongside copy button.
- AC5 (Pattern compliance): Pass — `ghost` icon button, `aria-label`s, sizing/spacings match.
- AC6 (Row interactions unchanged): Pass — No interference with hover/selection/sorting.
- AC7 (Unit tests): Pass — Rendering, clipboard behavior, a11y labels, mailto non-interference.
- AC8 (Docs updated): Pass — Story updated with Dev Agent Record and change log.
- AC9 (No regression): Pass — Existing quick-jump links verified.

Test run summary:
- Command: `npm run test`
- Result: 1 file, 9 tests passed
