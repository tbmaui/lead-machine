# Story 1.12: Column Filtering and Inline Search in Leads Table — Brownfield Addition

## Status

Approved

## User Story

As a sales user,
I want to quickly narrow the leads table by typing and toggling per-column filters,
so that I can focus on the most relevant leads without exporting or manually scanning.

## Context Source

- PRD: FR7 (overhauled table columns), NFR1/NFR4 (smooth UX, performance)
- Existing component: `src/components/LeadsTable.tsx`
- Related features: quick-jump links (1.4), copy shortcuts (1.5), truncation/tooltips (1.6), sorting (1.11). Filtering must not interfere with these interactions or header-sort controls.

## Acceptance Criteria

1. Per-column text filters are available for: Name, Title, Company, Email, Location.
   - Case-insensitive substring match; inputs trimmed; empty input removes the constraint.
2. Boolean filters are available as small chips/toggles: Has Email, Has Phone.
3. Score filter supports a min/max numeric range (two inputs or a range slider). Non-numeric or empty values are ignored.
4. Multiple filters combine with AND semantics; only rows satisfying all active filters are shown.
5. Text filters debounce input by ~200ms to avoid UI jank while typing.
6. A visible "Clear all" control resets all filters to none in a single action.
7. When any filter is active, show an indicator and a concise count: "Showing X of Y leads".
8. Filtering is applied before sorting; sorting (1.11) continues to work on the filtered set.
9. Filters are fully keyboard accessible with labels, focus order, and `aria` where appropriate.
10. Interaction safety: Clicking quick-jump links or copy buttons within cells does not affect filters or sorting.
11. Performance remains smooth up to 5,000 rows (no noticeable lag on input changes).
12. Initial load has no filters applied. (Optional: URL query persistence may be considered in a follow-up story.)

## Integration Requirements

- `LeadsTable.tsx`
  - Add internal `filters` state: `{ text: { name, title, company, email, location }, hasEmail, hasPhone, scoreMin, scoreMax }`.
  - Implement a pure `applyFilters(leads, filters)` utility that normalizes strings and evaluates constraints.
  - Compute `filteredLeads` with `useMemo` from `leads` and `filters`. Apply existing sorting on `filteredLeads`.
  - Add small header filter inputs/buttons aligned with shadcn styles; ensure they do not overlap header sort hit-targets.
  - Show a compact toolbar above the table for active-filter chips and a "Clear all" button.
- Tests
  - Unit tests for `applyFilters` covering each column, boolean toggles, score ranges, combined constraints, and missing/`N/A` values.
  - Interaction tests verifying: filters + sorting order; quick-jump/copy remain functional and do not toggle filters/sort.

## Quality

- Tests cover: normalization (case-insensitive, trim), boolean toggles, numeric ranges, AND-composition, and stability with missing values.
- A11y verified: labels, focus management, and clear affordances for filter controls.
- No regressions to Stories 1.4–1.6 and 1.11 behaviors.

## QA Results

- Status: Partial Pass
- Verified:
  - Text filters (Name, Title, Company, Email, Location) with case-insensitive trim; AND composition.
  - Boolean toggles (Has Email, Has Phone) default ON; Clear all restores defaults.
  - Score min/max respected; empty/non-numeric ignored; combines with other filters.
  - Debounce ~200ms; filtering precedes sorting; indicator shows "Showing X of Y leads".
  - Sorting stable on filtered set; quick-jump/copy do not affect filters/sort.
  - A11y: labels present; aria-sort; filter panel is toggleable.
  - URL columns present: LinkedIn, Company Website, Company LinkedIn.
- Gaps:
  - Active-filter chips not implemented yet.
  - Manual perf check at ~5,000 rows pending.

## Technical Notes

- Prefer deriving a lightweight, normalized key per row once (e.g., `normalizedTitle`, `normalizedCompany`) before filtering to reduce per-keystroke work.
- Use `useDeferredValue` or simple 200ms debounce for text inputs to maintain responsiveness.
- Avoid mutating props; keep utilities pure and easily testable.
- Keep UI consistent with Neumorphism style and existing shadcn/ui components; reuse `input`, `button`, `toggle`, and `badge/chip` patterns.

## Tasks / Subtasks

- [ ] Design filter UX: header inputs vs. compact toolbar placement; ensure mobile responsiveness.
- [ ] Implement `applyFilters` utility and integrate with `LeadsTable.tsx` state.
- [ ] Add header/toolbar controls: text inputs, hasEmail/hasPhone toggles, score min/max.
- [ ] Add active-filter chips and "Clear all".
- [ ] Wire filtering before sorting and ensure interaction safety with links/buttons.
- [ ] Add unit and interaction tests.
- [ ] Manual QA with large dataset (mock ~5,000 rows) to validate performance and a11y.

## Definition of Done

- All acceptance criteria met; filters AND-combine; sorting works on filtered results.
- A11y confirmed; controls labeled and keyboard-navigable.
- Tests pass; no regressions to sorting, quick-jump, copy, truncation/tooltips.
- Performance acceptable per NFR1/NFR4.

## References

- PRD: `docs/lead-machine-brownfield-enhancement-prd/requirements.md` (FR7, NFR1, NFR4)
- Component: `src/components/LeadsTable.tsx`
- Tests: `src/components/LeadsTable.test.tsx`
- Styling: `docs/lead-machine-brownfield-frontend-architecture-document/styling-guidelines.md`

## Change Log

| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-08-22 | 1.0 | Drafted Story 1.12 — Column filtering & search | Scrum Master |
