# Story 1.11: Dynamic Sorting in Leads Table — Brownfield Addition

## Status

Approved

## User Story

As a sales user,
I want to sort the leads table by any visible column,
so that I can quickly organize and analyze lead data without exporting.

## Context Source

- PRD FR8: "The overhauled lead table shall support dynamic sorting of its columns."
- Existing component: `src/components/LeadsTable.tsx` (currently renders columns without sort controls)
- Related features: quick-jump links (1.4), copy buttons (1.5), truncation/tooltips (1.6). Sorting must not interfere with these interactions.

## Acceptance Criteria

1. Clicking a column header toggles sorting for that column: none → ascending → descending → none.
2. Sorted state is visually indicated on the active column header (e.g., up/down chevron with subtle highlight) and announced for accessibility.
3. Supported sortable columns at minimum: Name, Title, Company, Phone, Email, Location, Score.
4. Sorting is stable for equal values and handles missing/`N/A` gracefully (missing values sort last in ascending, first in descending, or as specified consistently).
5. Sorting does not trigger navigation or row selection; quick-jump links and copy buttons remain fully functional.
6. Performance remains smooth with up to 5,000 rows (no noticeable UI lag on sort toggles).
7. Initial load has no forced sort (natural order), unless a default is explicitly configured (out of scope here).

## Integration Requirements

- `LeadsTable.tsx`
  - Implement internal state for `sortKey` and `sortDirection` with a pure sorting function that handles string and numeric fields.
  - Normalize string comparisons (case-insensitive, trim) and extract derived fields consistently (e.g., `displayCompany`, computed `location`).
  - Add header buttons with `aria-sort` attributes and keyboard support.
- Tests
  - Unit tests verifying ascending/descending/none cycles and correct ordering for each column.
  - Tests confirm links/buttons continue to work and do not toggle sorting when clicked.

## Quality

- Unit tests cover: sort comparator logic, toggling behavior, handling of missing values, and stability.
- No regressions to Stories 1.4–1.6 behaviors; truncation/tooltips unaffected; a11y maintained.

## Technical Notes

- Implement a generic comparator factory: `createComparator(sortKey, direction)` with handlers for string, number.
- For derived values, compute once per row in a mapped array before sorting to avoid repeated work.
- Avoid mutating the original `leads` prop; sort a copied array.
- Add small chevron icons in headers (use lucide-react) consistent with shadcn styles; subtle highlight on active column.

## Tasks / Subtasks

- [x] Implement sort state and header UI with `aria-sort`.
- [x] Add comparator and derived value extraction.
- [x] Ensure quick-jump/copy controls do not trigger sorting; only header clicks toggle.
- [x] Add unit tests for each sortable column and interaction safety.
- [ ] Manual QA with large dataset (mock 5,000 rows) to validate performance.

## Definition of Done

- Sorting works for all listed columns with correct cycles and a11y.
- Tests pass; no regressions to link/copy/truncation behaviors.
- Performance acceptable per NFR1/NFR4.

## QA Results

- Automated tests: PASS (LeadsTable sorting and interaction safety; total suite 23/23).
- Accessibility: `aria-sort` on active column, header controls are buttons and keyboard-accessible.
- Stability & missing handling: Verified stable ordering; missing values sort last (asc) and first (desc).
- Interaction safety: Quick-jump links and copy buttons do not toggle sorting.
- Performance: Comparator is O(n log n), derived fields computed once per row; expected smoothness up to 5,000 rows. Manual large-dataset run recommended.

## References

- PRD: `docs/lead-machine-brownfield-enhancement-prd/requirements.md` (FR8)
- Component: `src/components/LeadsTable.tsx`
- Tests: `src/components/LeadsTable.test.tsx`

## Change Log

| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-08-22 | 1.0 | Drafted Story 1.11 — Dynamic Sorting | Scrum Master |


