# Story 1.6: Truncated Cells with Tooltips in Lead Table — Brownfield Addition

## Status

Approved

## Story

As a sales user,
I want long text in the lead table to truncate with ellipses and show the full value on hover/focus,
so that the table stays compact without horizontal scrolling while still letting me access full details quickly.

## Story Context

- Existing component: `src/components/LeadsTable.tsx`
- Tech stack: React + TypeScript, Tailwind CSS, shadcn/ui, Vite
- Related prior stories: 1.4 (quick-jumping links), 1.5 (copy shortcuts). Ensure no regressions in link/copy interactions or layout.

## Acceptance Criteria

1. Truncation is applied to long values in the following cells: Name, Title, Company, Email, Location.
2. Truncated values render an ellipsis and expose the full value via a native `title` attribute; focus/hover reveals the full content.
3. No horizontal scrolling is introduced; the table remains within the viewport width (aligns with PRD NFR2).
4. Existing link/copy controls remain visible, aligned, and fully functional; clicks do not trigger row-level interactions (`stopPropagation()` where applicable).
5. Email continues to use the existing `mailto:` anchor; truncation does not interfere with the link.
6. Responsive behavior: On smaller viewports, the layout remains readable and compact; truncation and widths adapt without layout breaking.
7. Unit tests cover: conditional truncation rendering for long values, presence of `title` attributes with full values, preservation of link and copy behaviors.

## Tasks / Subtasks

- [x] Add truncation and width utilities to targeted cells in `src/components/LeadsTable.tsx` (AC: 1,3,6)
  - [x] Wrap text values in spans with `className="truncate whitespace-nowrap overflow-hidden text-ellipsis"` and reasonable `max-w-*` widths per column
  - [x] Set `title={fullValue}` on truncated text elements (AC: 2)
- [x] Ensure link/copy buttons retain existing styling and `onClick={(e) => e.stopPropagation()}` (AC: 4,5)
- [x] Validate responsive widths using Tailwind utilities (e.g., `max-w-[ch]`, `sm:max-w-*`) to avoid horizontal scroll (AC: 3,6)
- [x] Write unit tests in `src/components/LeadsTable.test.tsx`
  - [x] Render long strings and assert truncated classes and `title` presence (AC: 7)
  - [x] Assert `mailto:` link still present and functional; copy buttons still invoke clipboard and toasts (AC: 4,5,7)
- [ ] Manual smoke: verify no horizontal scroll appears and prior stories’ behaviors persist (AC: 3,4,5,6)

## Dev Notes

- Project structure and locations: `src/components/LeadsTable.tsx` per architecture structure [Source: docs/lead-machine-brownfield-frontend-architecture-document/project-structure.md]
- Styling approach: Use Tailwind utility classes to implement truncation and widths while maintaining the Neumorphism style; avoid new dependencies. [Source: docs/lead-machine-brownfield-frontend-architecture-document/styling-guidelines.md]
- PRD constraint: Keep content on one screen without horizontal scrolling (NFR2). [Source: docs/lead-machine-prd/requirements.md]
- Testing: Use @testing-library/react, Arrange-Act-Assert, 80%+ coverage for changed files. [Source: docs/lead-machine-brownfield-frontend-architecture-document/testing-requirements.md]
- Implementation guidance:
  - Keep `table-fixed` and apply column-level width constraints using container divs/spans with `max-w-*` and `truncate`.
  - For links (`a`) and copy buttons, preserve existing `buttonVariants({ variant: 'ghost', size: 'sm' })` and `onClick` propagation guards.
  - Use native `title` attributes for hover/focus full-value reveal to avoid introducing a tooltip library.

## Testing

- Place tests alongside the component: `src/components/LeadsTable.test.tsx`
- Cases:
  - Long `company`/`title`/`email`/`name`/`location` values get `title` and truncation classes
  - `mailto:` link still present and correctly wraps email text
  - Copy buttons work as before (success/error paths), events emitted, toasts shown
  - No interference with quick-jump links (LinkedIn, Website)

## Change Log

| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-08-21 | 1.0 | Drafted Story 1.6 — Truncated cells with tooltips | Scrum Master |
| 2025-08-21 | 1.1 | Approved | PO |
| 2025-08-21 | 1.2 | Implemented truncation + tests; awaiting manual smoke | Dev Agent |

## Dev Agent Record

### Agent Model Used

GPT-5 (Cursor) — Dev Agent

### Debug Log References

- Vitest run: 10 tests passed in `src/components/LeadsTable.test.tsx` (quick-jump links, copy buttons, truncation)

### Completion Notes List

- Implemented truncation with responsive `max-w-*` and `title` attributes across Name, Title, Company, Email, Location.
- Preserved link/copy behaviors; tests verify `mailto:` and copy events.

### File List

- src/components/LeadsTable.tsx
- src/components/LeadsTable.test.tsx

## QA Results

- Automated tests: 10/10 passing via Vitest.
- Coverage (V8): Statements 91.79%, Branches 67.44%, Functions 85.71%, Lines 91.79% for `src/components/LeadsTable.tsx`.
- Manual: Visual check confirms truncation, widened Score column, no overlap at current data; further width tuning pending restoration of Company/Phone data.
